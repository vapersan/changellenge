{% extends 'changellenge/base/base.html' %}
{% load static %}
{% load martortags %}
{% load changellenge %}
{% block content %}
    <header>
        <nav class="navbar navbar-light navbar-expand-md navigation-clean-button bg-color border-bottom">
            <div class="container"><img class="nav-logo" src="{% static 'changellenge/assets/img/logo.png' %}">
                <h2 class="display-1 text-info hsm-nav">Hydra Search Micro</h2>
                <button data-toggle="collapse" class="navbar-toggler" data-target="#navcol-1"><span class="sr-only">Toggle navigation</span><span
                        class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse ml-3"
                     id="navcol-1">
                    <ul class="nav navbar-nav mr-auto">
                        <li class="nav-item" role="presentation"><a class="nav-link" href="#"
                                                                    style="font-family: Montserrat, sans-serif;">Каталог</a>
                        </li>
                        <li class="nav-item" role="presentation"><a class="nav-link" href="#add"
                                                                    style="font-family: Montserrat, sans-serif;"
                                                                    data-toggle="modal">Добавить</a></li>
                        <li class="nav-item" role="presentation"><a class="nav-link" href="#"
                                                                    style="font-family: Montserrat, sans-serif;">Мои
                            сервисы</a></li>
                    </ul>
                    <a class="nav-link st-link" href="#" style="font-family: Montserrat, sans-serif;">Личный кабинет</a>
                </div>
            </div>
        </nav>
    </header>
    <div class="mt-1" id="app">
        <div class="container">
            <div class="row mb-3 mt-3">
                <div class="col justify-content-xl-start">
                    <form class="d-lg-flex d-xl-flex">
                        {% for service_sate in service_sates %}
                            <div class="form-check border rounded" style="padding: 0;">
                                <input class="form-check-input" type="radio" id="{{ service_sate.0 }}" name="sort"
                                       style="display: none;" value="{{ service_sate.0 }}">
                                <label class="form-check-label radio-lab" @click="filterParam='{{ service_sate.0 }}'"
                                       for="{{ service_sate.0 }}">{{ service_sate.1 }}</label>
                            </div>
                        {% endfor %}
                        <input class="form-control search-stl"
                               type="search" placeholder="Поиск">
                        <div class="dropdown bg-info border rounded border-info drp-stl">
                            <button class="btn btn-info dropdown-toggle drp-itm" data-toggle="dropdown"
                                    aria-expanded="false">Теги
                            </button>
                            <div class="dropdown-menu drp-itm" role="menu">
                                <a class="dropdown-item" role="presentation" href="#">SQL</a>
                                <a class="dropdown-item" role="presentation" href="#">Аналитика</a>
                                <a class="dropdown-item" role="presentation" href="#">Интеграция</a>
                                <a class="dropdown-item" role="presentation" href="#">Вычисления</a>
                                <a class="dropdown-item" role="presentation" href="#">Рассылка</a>
                                <a class="dropdown-item" role="presentation" href="#">Мультимедиа</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6 col-lg-4 mb-3" data-aos="fade" v-for="service in filtredServices">
                    <div class="card">
                        <div class="card-body" style="font-family: Montserrat, sans-serif;">
                            <h4 class="card-title">
                                {% templatetag openvariable %} service.name {% templatetag closevariable %}
                            </h4>
                            <h6 class="text-muted card-subtitle mb-2">SQL</h6>
                            <p class="card-text" v-html="service.about">
                            </p>
                            <button class="btn btn-info" type="button" data-toggle="modal" data-target="#more">
                                Подробнее
                            </button>
                            <a class="card-link text-dark" href="javascript:void(0);">
                                <img class="float-right heart"
                                     src="{% static 'changellenge/assets/img/heartt.png' %}" alt="...">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" role="dialog" tabindex="-1" id="more" data-toggle="modal"
         style="font-family: Montserrat, sans-serif;">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Amazon DynamoDB<br></h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">×</span></button>
                </div>
                <div class="modal-body">
                    <p>Статус:&nbsp;<em
                            style="font-family: Montserrat, sans-serif;font-weight: bold;font-style: normal;opacity: 1;font-size: 14px;color: #0b8d00;">готовое<br></em>
                    </p>
                    <hr>
                    <p>Теги:&nbsp;<a class="mr-1" href="#"
                                     style="color: #007b8d;font-weight: bold;font-family: Montserrat, sans-serif;font-style: normal;font-size: 14px;">SQL</a>
                    </p>
                    <hr>
                    <span>Amazon DynamoDB&nbsp;– это база данных пар «ключ‑значение» и документов, которая обеспечивает задержку менее 10&nbsp;миллисекунд при работе в любом масштабе.<br></span>
                </div>
                <div class="modal-footer flex-row-reverse"><span>Разработчики:&nbsp;<a class="text-black-50 mr-1"
                                                                                       href="#">Лейкин Гриша,</a><a
                        class="text-black-50 mr-1" href="#">Лейкин Гриша,</a><a class="text-black-50 mr-1" href="#">Лейкин Гриша</a></span>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" role="dialog" tabindex="-1" id="add" style="font-family: Montserrat, sans-serif;">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title"
                        style="font-family: Montserrat, sans-serif;font-weight: 500;font-style: normal;">Добавление
                        сервиса</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">×</span></button>
                </div>
                <div class="modal-body">
                    <form method="post" action="#">
                        {% autoescape off %}
{#                            {{ None|get_martor_css }}#}
                        {% endautoescape %}
                        {% autoescape off %}
{#                            {{ None|get_martor_js }}#}
                        {% endautoescape %}
                        <p>
                            Название:&nbsp;<input class="border rounded form-control" type="text" required=""
                                                  name="name">
                        </p>
                        <p>
                            Описание:&nbsp;{{ form.about }}
                        </p>
                        <p class="mb-0">
                            Авторы:&nbsp;
                        </p>
                        <div class="form-group">
                            <input class="form-control form-control mb-1" type="text" name="authors"
                                   value="{{ request.user.first_name }} {{ request.user.last_name }}" placeholder=" ">
                        </div>
                        <p class="mb-0">&nbsp;Связанные сервисы:</p>
                        <div class="form-group">
                            <input class="form-control form-control mb-1" type="text" name="parents"
                                   value="" placeholder=" "></div>
                        <p class="mb-0">Тег:</p>
                        <div class="form-group"><input class="form-control form-control mb-1" type="text" name="tags"
                                                       value="" placeholder=" "></div>
                        <button class="btn btn-info" type="button">Добавить</button>
                        <button class="btn btn-light ml-3" type="button" data-dismiss="modal">Закрыть</button>
                        <span
                                class="text-uppercase float-right mt-2"
                                style="font-weight: bold;color: #0b8d00;font-size: 14px;">добавлено</span>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block extra_js %}
    <script src="https://unpkg.com/vue"></script>
    <script>
        let app = new Vue({
            el: "#app",
            data: {
                filterParam: '',
                services: [
                    {% autoescape off %}
                        {% for service in services %}
                            {
                                'id': {{ service.id }},
                                'name': `{{ service.name }}`,
                                {% autoescape off %}
                                'about': `{{ service.about|safe_markdown|truncatechars_html:100 }}`,
                                {% endautoescape %}
                                'status': `{{ service.status }}`
                            },
                        {% endfor %}
                    {% endautoescape %}
                ]
            },
            computed: {
                filtredServices() {
                    if (this.filterParam === '')
                        return this.services;
                    return this.services.filter(data => data['status'] === this.filterParam);
                }
            }
        });
    </script>
    <script>
        $('input[name="authors"]').amsifySuggestags({
            type: 'amsify',
            {% autoescape off %}
                suggestions: {{ users }},
            {% endautoescape %}
            whiteList: true
        });
        $('input[name="parents"]').amsifySuggestags({
            type: 'amsify',
            {% autoescape off %}
                {% for service in services %}
                    suggestions: {{ services_name }},
                {% endfor %}
            {% endautoescape %}
            whiteList: true
        });
        $('input[name="tags"]').amsifySuggestags({
            type: 'amsify',
            {% autoescape off %}
                {% for service in services %}
                    suggestions: {{ tags }},
                {% endfor %}
            {% endautoescape %}
            whiteList: true
        });
    </script>
{% endblock %}